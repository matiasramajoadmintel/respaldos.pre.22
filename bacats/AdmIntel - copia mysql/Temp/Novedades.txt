DROP VIEW VW_TRAB_PAGADOS;

CREATE VIEW VW_TRAB_PAGADOS (
  IDTRABAJO,
  IDPAGO,
  DESCRIP,
  IMPORTE,
  FECHA,
  IDEDIFICIO,
  TIPO_TRAB
) AS

SELECT TRABAJO.IDTRABAJO, Trabajo.IDPAGO,   ( ('Factura Nº ' || Trabajo.NRO_FACTURA)  || ' - ')  || Categoria.DESCRIP , Trabajo.COSTO, Trabajo.FECHA_FIN, Depto_edif.IDEDIF, TRABAJO.TIPO_TRAB
FROM TRABAJO Trabajo
   INNER JOIN CATEGORIA Categoria
   ON  (Trabajo.IDCATEGORIA = Categoria.IDCATEGORIA)
   INNER JOIN TRAB_DEPTO Trab_depto
   ON  (Trabajo.IDTRABAJO = Trab_depto.IDTRABAJO)
   INNER JOIN DEPTO_EDIF Depto_edif
   ON  (Trab_depto.IDDEPARTAMENTO = Depto_edif.IDDEPTO)
WHERE  Trabajo.PAGADO = 'Sí'
UNION
SELECT TRABAJO.IDTRABAJO, Trabajo.IDPAGO,   ( ('Factura Nº ' || Trabajo.NRO_FACTURA)  || ' - ')  || Categoria.DESCRIP , Trabajo.COSTO, Trabajo.FECHA_FIN, Trab_edif.IDEDIFICIO, TRABAJO.TIPO_TRAB
FROM TRABAJO Trabajo
   INNER JOIN CATEGORIA Categoria
   ON  (Trabajo.IDCATEGORIA = Categoria.IDCATEGORIA)
   INNER JOIN TRAB_EDIF Trab_edif
   ON  (Trabajo.IDTRABAJO = Trab_edif.IDTRABAJO)
WHERE  Trabajo.PAGADO = 'Sí'
;

DROP VIEW VW_TRAB_EDIF;

CREATE VIEW VW_TRAB_EDIF (
  IDTRABAJO,
  NRO_PEDIDO,
  FECHA_INI,
  FECHA_FIN,
  COSTO,
  IMPUTACION,
  IDEDIFICIO,
  ESPACIO,
  RAZON_SOCIAL,
  NRO_FACTURA,
  DESCRIP
) AS

SELECT Trabajo.IDTRABAJO, Trabajo.NRO_PEDIDO, Trabajo.FECHA_INI, Trabajo.FECHA_FIN, Trabajo.COSTO, Trabajo.IMPUTACION, Trab_edif.IDEDIFICIO, Tipo_espacio.DESCRIP, Proveedor.RAZON_SOCIAL, Trabajo.NRO_FACTURA, Categoria.DESCRIP
FROM TRABAJO Trabajo
   INNER JOIN TRAB_EDIF Trab_edif
   ON  (Trabajo.IDTRABAJO = Trab_edif.IDTRABAJO)
   LEFT OUTER JOIN PROVEEDOR Proveedor
   ON  (Trabajo.IDPROVEEDOR = Proveedor.IDPROVEEDOR)
   INNER JOIN CATEGORIA Categoria
   ON  (Trabajo.IDCATEGORIA = Categoria.IDCATEGORIA)
   INNER JOIN TIPO_ESPACIO Tipo_espacio
   ON  (Trab_edif.IDTIPO_ESPACIO = Tipo_espacio.IDTIPO_ESPACIO)
;